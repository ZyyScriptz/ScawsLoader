if _G.KovariLoaded then
    warn("[Kovari] Library already loaded in this game session")
    return _G.KovariInstance
end
_G.KovariLoaded = true

local Kovari = {}
Kovari.__index = Kovari

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local MarketplaceService = game:GetService("MarketplaceService")
local TextService = game:GetService("TextService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")

-- Player
local LocalPlayer = Players.LocalPlayer

-- Theme Configuration
local Theme = {
    -- Backgrounds
    Primary = Color3.fromRGB(0, 0, 0),
    Secondary = Color3.fromRGB(18, 18, 20),
    Tertiary = Color3.fromRGB(28, 28, 32),
    Elevated = Color3.fromRGB(38, 38, 42),
    
    -- Interactive
    Fill = Color3.fromRGB(48, 48, 54),
    FillHover = Color3.fromRGB(58, 58, 66),
    FillPressed = Color3.fromRGB(68, 68, 76),
    
    -- Accent
    Accent = Color3.fromRGB(88, 86, 214),
    AccentLight = Color3.fromRGB(108, 106, 234),
    AccentDark = Color3.fromRGB(68, 66, 194),
    AccentMuted = Color3.fromRGB(88, 86, 214),
    
    -- Text
    TextPrimary = Color3.fromRGB(255, 255, 255),
    TextSecondary = Color3.fromRGB(142, 142, 147),
    TextTertiary = Color3.fromRGB(99, 99, 102),
    TextDisabled = Color3.fromRGB(72, 72, 74),
    
    -- Semantic
    Success = Color3.fromRGB(52, 199, 89),
    Warning = Color3.fromRGB(255, 159, 10),
    Error = Color3.fromRGB(255, 69, 58),
    Info = Color3.fromRGB(10, 132, 255),
    
    -- Borders
    Border = Color3.fromRGB(44, 44, 48),
    BorderLight = Color3.fromRGB(54, 54, 58),
    Separator = Color3.fromRGB(38, 38, 42),
    
    -- Typography
    FontRegular = Enum.Font.GothamMedium,
    FontMedium = Enum.Font.GothamMedium,
    FontSemibold = Enum.Font.GothamSemibold,
    FontBold = Enum.Font.GothamBold,
    
    -- Sizing
    CornerRadius = 12,
    CornerRadiusSmall = 8,
    CornerRadiusLarge = 16,
    
    -- Animation
    SpringSpeed = 0.25,
    SpringDamping = 0.75,
    QuickSpeed = 0.1,
    NormalSpeed = 0.18,
    SlowSpeed = 0.3,
}

-- Utility Functions
local Util = {}

function Util.Create(className, properties)
    local instance = Instance.new(className)
    for key, value in pairs(properties or {}) do
        if key ~= "Parent" then
            pcall(function()
                instance[key] = value
            end)
        end
    end
    if properties and properties.Parent then
        instance.Parent = properties.Parent
    end
    return instance
end

function Util.Tween(object, properties, duration, style, direction)
    if not object then return end
    local tweenInfo = TweenInfo.new(
        duration or Theme.NormalSpeed,
        style or Enum.EasingStyle.Quint,
        direction or Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(object, tweenInfo, properties)
    tween:Play()
    return tween
end

function Util.Spring(object, properties, speed, damping)
    if not object then return end
    local tweenInfo = TweenInfo.new(
        speed or Theme.SpringSpeed,
        Enum.EasingStyle.Back,
        Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(object, tweenInfo, properties)
    tween:Play()
    return tween
end

function Util.Corner(parent, radius)
    return Util.Create("UICorner", {
        CornerRadius = UDim.new(0, radius or Theme.CornerRadius),
        Parent = parent
    })
end

function Util.Stroke(parent, color, thickness, transparency)
    return Util.Create("UIStroke", {
        Color = color or Theme.Border,
        Thickness = thickness or 1,
        Transparency = transparency or 0,
        ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
        Parent = parent
    })
end

function Util.Padding(parent, padding)
    local p = padding or 12
    return Util.Create("UIPadding", {
        PaddingTop = UDim.new(0, p),
        PaddingBottom = UDim.new(0, p),
        PaddingLeft = UDim.new(0, p),
        PaddingRight = UDim.new(0, p),
        Parent = parent
    })
end

function Util.Shadow(parent, offset, transparency)
    return Util.Create("ImageLabel", {
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(0.5, 0, 0.5, offset or 4),
        Size = UDim2.new(1, 30, 1, 30),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5554236805",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = transparency or 0.5,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(23, 23, 277, 277),
        ZIndex = -1,
        Parent = parent
    })
end

function Util.Ripple(button)
    local ripple = Util.Create("Frame", {
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 0.85,
        ZIndex = button.ZIndex + 1,
        Parent = button
    })
    Util.Corner(ripple, 100)
    
    local maxSize = math.max(button.AbsoluteSize.X, button.AbsoluteSize.Y) * 2.5
    Util.Tween(ripple, {
        Size = UDim2.new(0, maxSize, 0, maxSize),
        BackgroundTransparency = 1
    }, 0.5)
    
    task.delay(0.5, function()
        if ripple and ripple.Parent then
            ripple:Destroy()
        end
    end)
end

function Util.GetGameName()
    local success, name = pcall(function()
        return MarketplaceService:GetProductInfo(game.PlaceId).Name
    end)
    return success and name or "Unknown Game"
end

function Util.FormatDate(timestamp)
    local date = os.date("*t", timestamp)
    local months = {"Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"}
    return string.format("%s %d, %d", months[date.month], date.day, date.year)
end

function Util.Lerp(a, b, t)
    return a + (b - a) * t
end

-- Animation Helpers
local Animate = {}

function Animate.FadeIn(object, duration, delay)
    delay = delay or 0
    duration = duration or Theme.NormalSpeed
    
    if object:IsA("Frame") or object:IsA("TextLabel") or object:IsA("TextButton") or object:IsA("TextBox") then
        local originalTransparency = object:GetAttribute("TargetBgTransparency") or 0
        object.BackgroundTransparency = 1
        
        task.delay(delay, function()
            Util.Tween(object, {BackgroundTransparency = originalTransparency}, duration)
        end)
    end
    
    if object:IsA("TextLabel") or object:IsA("TextButton") or object:IsA("TextBox") then
        local originalTextTransparency = object:GetAttribute("TargetTextTransparency") or 0
        object.TextTransparency = 1
        
        task.delay(delay, function()
            Util.Tween(object, {TextTransparency = originalTextTransparency}, duration)
        end)
    end
    
    if object:IsA("ImageLabel") or object:IsA("ImageButton") then
        local originalTransparency = object:GetAttribute("TargetImageTransparency") or 0
        object.ImageTransparency = 1
        
        task.delay(delay, function()
            Util.Tween(object, {ImageTransparency = originalTransparency}, duration)
        end)
    end
end

function Animate.SlideIn(object, direction, duration, delay)
    delay = delay or 0
    duration = duration or Theme.NormalSpeed
    direction = direction or "up"
    
    local originalPosition = object.Position
    local offsetY = direction == "up" and 20 or (direction == "down" and -20 or 0)
    local offsetX = direction == "left" and 20 or (direction == "right" and -20 or 0)
    
    object.Position = UDim2.new(
        originalPosition.X.Scale,
        originalPosition.X.Offset + offsetX,
        originalPosition.Y.Scale,
        originalPosition.Y.Offset + offsetY
    )
    
    task.delay(delay, function()
        Util.Spring(object, {Position = originalPosition}, duration)
    end)
end

function Animate.ScaleIn(object, duration, delay)
    delay = delay or 0
    duration = duration or Theme.SpringSpeed
    
    local originalSize = object.Size
    object.Size = UDim2.new(
        originalSize.X.Scale * 0.95,
        originalSize.X.Offset * 0.95,
        originalSize.Y.Scale * 0.95,
        originalSize.Y.Offset * 0.95
    )
    
    task.delay(delay, function()
        Util.Spring(object, {Size = originalSize}, duration)
    end)
end

-- Junkie Key System Handler
local JunkieKeySystem = {}

function JunkieKeySystem.new(config)
    local self = setmetatable({}, {__index = JunkieKeySystem})
    
    -- Junkie Configuration
    self.Service = config.Service or "key system"
    self.Identifier = config.Identifier or tostring(LocalPlayer.UserId)
    self.Provider = config.Provider or "key system"
    self.ApiKey = config.ApiKey or "0015f93e-20bf-48fb-a444-33b056019ebe"
    
    -- Load Junkie SDK
    self.Junkie = nil
    local success, result = pcall(function()
        return loadstring(game:HttpGet("https://jnkie.com/sdk/library.lua"))()
    end)
    
    if success and result then
        self.Junkie = result
        self.Junkie.service = self.Service
        self.Junkie.identifier = self.Identifier
        self.Junkie.provider = self.Provider
    else
        warn("[Kovari] Failed to load Junkie SDK:", result)
    end
    
    return self
end

function JunkieKeySystem:GetKeyLink()
    if not self.Junkie then
        return false, "Junkie SDK not loaded"
    end
    
    local success, result = pcall(function()
        return self.Junkie.get_link()
    end)
    
    if success and result then
        return true, result
    else
        return false, "Failed to get key link"
    end
end

function JunkieKeySystem:CopyLink()
    local success, link = self:GetKeyLink()
    if success then
        pcall(function()
            (setclipboard or toclipboard or function() end)(link)
        end)
        return true
    end
    return false
end

function JunkieKeySystem:VerifyKey(key)
    if not self.Junkie then
        return false, "Junkie SDK not loaded"
    end
    
    if not key or key == "" then
        return false, "Please enter a key"
    end
    
    local success, result = pcall(function()
        return self.Junkie.check_key(key)
    end)
    
    if success and result then
        if result.valid then
            return true, "Key verified!"
        else
            return false, result.message or "Invalid key"
        end
    else
        return false, "Verification failed"
    end
end

-- Key System UI
function Kovari:CreateKeyUI(config)
    config = config or {}
    
    local keyHandler = JunkieKeySystem.new({
        Service = config.Service or "key system",
        Identifier = config.Identifier or tostring(LocalPlayer.UserId),
        Provider = config.Provider or "key system",
        ApiKey = config.ApiKey or "0015f93e-20bf-48fb-a444-33b056019ebe"
    })
    
    local title = config.Title or "KOVARI"
    local subtitle = config.Subtitle or "Key System"
    local discordLink = config.Discord or "discord.gg/QcvddpVeTM"
    local onSuccess = config.OnSuccess or function() end
    local onFailed = config.OnFailed or function() end
    
    -- Set global flags
    getgenv().SCRIPT_KEY = nil
    getgenv().UI_CLOSED = false
    
    -- Create ScreenGui
    local ScreenGui = Util.Create("ScreenGui", {
        Name = "KovariKeySystem",
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        IgnoreGuiInset = true
    })
    
    pcall(function()
        if syn and syn.protect_gui then
            syn.protect_gui(ScreenGui)
            ScreenGui.Parent = CoreGui
        elseif gethui then
            ScreenGui.Parent = gethui()
        else
            ScreenGui.Parent = CoreGui
        end
    end)
    
    -- Blur Background
    local Blur = Util.Create("Frame", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Color3.fromRGB(0, 0, 0),
        BackgroundTransparency = 0.4,
        Parent = ScreenGui
    })
    
    -- Main Container
    local MainFrame = Util.Create("Frame", {
        Name = "Main",
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 400, 0, 340),
        BackgroundColor3 = Theme.Secondary,
        ClipsDescendants = true,
        Parent = ScreenGui
    })
    Util.Corner(MainFrame, Theme.CornerRadiusLarge)
    local MainStroke = Util.Stroke(MainFrame, Theme.Border, 1)
    local MainShadow = Util.Shadow(MainFrame, 6, 0.5)
    
    -- Header
    local Header = Util.Create("Frame", {
        Size = UDim2.new(1, 0, 0, 80),
        BackgroundColor3 = Theme.Tertiary,
        Parent = MainFrame
    })
    Util.Corner(Header, Theme.CornerRadiusLarge)
    
    local HeaderBottom = Util.Create("Frame", {
        Size = UDim2.new(1, 0, 0, 16),
        Position = UDim2.new(0, 0, 1, -16),
        BackgroundColor3 = Theme.Tertiary,
        BorderSizePixel = 0,
        Parent = Header
    })
    
    local HeaderDivider = Util.Create("Frame", {
        Size = UDim2.new(1, -32, 0, 1),
        Position = UDim2.new(0, 16, 1, 0),
        BackgroundColor3 = Theme.Separator,
        BorderSizePixel = 0,
        Parent = Header
    })
    
    -- Logo
    local LogoContainer = Util.Create("Frame", {
        Size = UDim2.new(0, 48, 0, 48),
        Position = UDim2.new(0, 20, 0.5, -24),
        BackgroundColor3 = Theme.Accent,
        Parent = Header
    })
    Util.Corner(LogoContainer, 10)
    
    local LogoIcon = Util.Create("ImageLabel", {
        Size = UDim2.new(1, -8, 1, -8),
        Position = UDim2.new(0, 4, 0, 4),
        BackgroundTransparency = 1,
        Image = "rbxassetid://104988871729944",
        ScaleType = Enum.ScaleType.Fit,
        Parent = LogoContainer
    })
    Util.Corner(LogoIcon, 6)
    
    -- Title
    local TitleLabel = Util.Create("TextLabel", {
        Size = UDim2.new(0, 200, 0, 22),
        Position = UDim2.new(0, 80, 0, 22),
        BackgroundTransparency = 1,
        Font = Theme.FontBold,
        Text = title,
        TextColor3 = Theme.TextPrimary,
        TextSize = 18,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = Header
    })
    
    local SubtitleLabel = Util.Create("TextLabel", {
        Size = UDim2.new(0, 200, 0, 16),
        Position = UDim2.new(0, 80, 0, 46),
        BackgroundTransparency = 1,
        Font = Theme.FontRegular,
        Text = subtitle,
        TextColor3 = Theme.TextSecondary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = Header
    })
    
    -- Content
    local Content = Util.Create("Frame", {
        Size = UDim2.new(1, -32, 1, -100),
        Position = UDim2.new(0, 16, 0, 88),
        BackgroundTransparency = 1,
        Parent = MainFrame
    })
    
    -- Key Input Section
    local InputSection = Util.Create("Frame", {
        Size = UDim2.new(1, 0, 0, 80),
        BackgroundColor3 = Theme.Tertiary,
        Parent = Content
    })
    Util.Corner(InputSection, Theme.CornerRadius)
    local InputStroke = Util.Stroke(InputSection, Theme.Border, 1)
    
    local InputLabel = Util.Create("TextLabel", {
        Size = UDim2.new(1, -24, 0, 20),
        Position = UDim2.new(0, 12, 0, 10),
        BackgroundTransparency = 1,
        Font = Theme.FontSemibold,
        Text = "Enter Your Key",
        TextColor3 = Theme.TextPrimary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = InputSection
    })
    
    local InputBox = Util.Create("Frame", {
        Size = UDim2.new(1, -24, 0, 36),
        Position = UDim2.new(0, 12, 0, 34),
        BackgroundColor3 = Theme.Fill,
        Parent = InputSection
    })
    Util.Corner(InputBox, Theme.CornerRadiusSmall)
    local InputBoxStroke = Util.Stroke(InputBox, Theme.Border, 1)
    
    local KeyInput = Util.Create("TextBox", {
        Size = UDim2.new(1, -20, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1,
        Font = Theme.FontRegular,
        PlaceholderText = "Paste your key here...",
        PlaceholderColor3 = Theme.TextTertiary,
        Text = "",
        TextColor3 = Theme.TextPrimary,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        ClearTextOnFocus = false,
        Parent = InputBox
    })
    
    -- Status
    local StatusLabel = Util.Create("TextLabel", {
        Size = UDim2.new(1, 0, 0, 20),
        Position = UDim2.new(0, 0, 0, 88),
        BackgroundTransparency = 1,
        Font = Theme.FontRegular,
        Text = "",
        TextColor3 = Theme.TextSecondary,
        TextSize = 11,
        Parent = Content
    })
    
    -- Buttons
    local ButtonContainer = Util.Create("Frame", {
        Size = UDim2.new(1, 0, 0, 40),
        Position = UDim2.new(0, 0, 0, 112),
        BackgroundTransparency = 1,
        Parent = Content
    })
    
    local VerifyButton = Util.Create("TextButton", {
        Size = UDim2.new(0.48, 0, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = Theme.Accent,
        Font = Theme.FontSemibold,
        Text = "Verify Key",
        TextColor3 = Theme.TextPrimary,
        TextSize = 13,
        AutoButtonColor = false,
        ClipsDescendants = true,
        Parent = ButtonContainer
    })
    Util.Corner(VerifyButton, Theme.CornerRadiusSmall)
    
    local GetKeyButton = Util.Create("TextButton", {
        AnchorPoint = Vector2.new(1, 0),
        Size = UDim2.new(0.48, 0, 1, 0),
        Position = UDim2.new(1, 0, 0, 0),
        BackgroundColor3 = Theme.Fill,
        Font = Theme.FontSemibold,
        Text = "Get Key",
        TextColor3 = Theme.TextPrimary,
        TextSize = 13,
        AutoButtonColor = false,
        ClipsDescendants = true,
        Parent = ButtonContainer
    })
    Util.Corner(GetKeyButton, Theme.CornerRadiusSmall)
    local GetKeyStroke = Util.Stroke(GetKeyButton, Theme.Border, 1)
    
    -- Discord Section
    local DiscordSection = Util.Create("Frame", {
        Size = UDim2.new(1, 0, 0, 44),
        Position = UDim2.new(0, 0, 0, 160),
        BackgroundColor3 = Theme.Tertiary,
        Parent = Content
    })
    Util.Corner(DiscordSection, Theme.CornerRadius)
    local DiscordStroke = Util.Stroke(DiscordSection, Theme.Border, 1)
    
    local DiscordIcon = Util.Create("TextLabel", {
        Size = UDim2.new(0, 30, 1, 0),
        Position = UDim2.new(0, 12, 0, 0),
        BackgroundTransparency = 1,
        Font = Theme.FontRegular,
        Text = "HELP",
        TextColor3 = Theme.TextTertiary,
        TextSize = 8,
        Parent = DiscordSection
    })
    
    local DiscordText = Util.Create("TextLabel", {
        Size = UDim2.new(0, 100, 1, 0),
        Position = UDim2.new(0, 44, 0, 0),
        BackgroundTransparency = 1,
        Font = Theme.FontSemibold,
        Text = "Need help?",
        TextColor3 = Theme.TextPrimary,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = DiscordSection
    })
    
    local DiscordButton = Util.Create("TextButton", {
        AnchorPoint = Vector2.new(1, 0.5),
        Size = UDim2.new(0, 100, 0, 28),
        Position = UDim2.new(1, -10, 0.5, 0),
        BackgroundColor3 = Theme.Fill,
        Font = Theme.FontSemibold,
        Text = "Join Discord",
        TextColor3 = Theme.TextPrimary,
        TextSize = 11,
        AutoButtonColor = false,
        Parent = DiscordSection
    })
    Util.Corner(DiscordButton, Theme.CornerRadiusSmall)
    local DiscordBtnStroke = Util.Stroke(DiscordButton, Theme.Border, 1)
    
    -- Footer
    local FooterLabel = Util.Create("TextLabel", {
        Size = UDim2.new(1, 0, 0, 16),
        Position = UDim2.new(0, 0, 1, -20),
        BackgroundTransparency = 1,
        Font = Theme.FontRegular,
        Text = "Powered by Junkie Key System",
        TextColor3 = Theme.TextTertiary,
        TextSize = 10,
        Parent = Content
    })
    
    -- Connections Storage
    local Connections = {}
    
    -- Dragging
    local dragging = false
    local dragStart, startPos
    local targetPos = MainFrame.Position
    
    table.insert(Connections, Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
        end
    end))
    
    table.insert(Connections, Header.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end))
    
    table.insert(Connections, UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            targetPos = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end))
    
    table.insert(Connections, RunService.RenderStepped:Connect(function()
        if dragging then
            MainFrame.Position = MainFrame.Position:Lerp(targetPos, 0.15)
        end
    end))
    
    -- Input Focus Effects
    table.insert(Connections, KeyInput.Focused:Connect(function()
        Util.Tween(InputBox, {BackgroundColor3 = Theme.FillHover}, Theme.QuickSpeed)
        Util.Tween(InputBoxStroke, {Color = Theme.Accent}, Theme.QuickSpeed)
    end))
    
    table.insert(Connections, KeyInput.FocusLost:Connect(function()
        Util.Tween(InputBox, {BackgroundColor3 = Theme.Fill}, Theme.QuickSpeed)
        Util.Tween(InputBoxStroke, {Color = Theme.Border}, Theme.QuickSpeed)
    end))
    
    -- Button Hover Effects
    local function SetupButton(button, isPrimary, stroke)
        local hovered, pressed = false, false
        
        local function UpdateState()
            local targetColor
            if pressed then
                targetColor = isPrimary and Theme.AccentDark or Theme.FillPressed
            elseif hovered then
                targetColor = isPrimary and Theme.AccentLight or Theme.FillHover
            else
                targetColor = isPrimary and Theme.Accent or Theme.Fill
            end
            Util.Tween(button, {BackgroundColor3 = targetColor}, Theme.QuickSpeed)
        end
        
        table.insert(Connections, button.MouseEnter:Connect(function()
            hovered = true
            UpdateState()
        end))
        
        table.insert(Connections, button.MouseLeave:Connect(function()
            hovered = false
            pressed = false
            UpdateState()
        end))
        
        table.insert(Connections, button.MouseButton1Down:Connect(function()
            pressed = true
            UpdateState()
        end))
        
        table.insert(Connections, button.MouseButton1Up:Connect(function()
            pressed = false
            UpdateState()
        end))
    end
    
    SetupButton(VerifyButton, true)
    SetupButton(GetKeyButton, false, GetKeyStroke)
    SetupButton(DiscordButton, false, DiscordBtnStroke)
    
    -- Status Function
    local function SetStatus(text, color)
        StatusLabel.Text = text
        StatusLabel.TextColor3 = color or Theme.TextSecondary
    end
    
    -- Close Function
    local function Close()
        for _, conn in ipairs(Connections) do
            conn:Disconnect()
        end
        
        Util.Tween(Blur, {BackgroundTransparency = 1}, Theme.NormalSpeed)
        Util.Tween(MainShadow, {ImageTransparency = 1}, Theme.QuickSpeed)
        Util.Tween(MainStroke, {Transparency = 1}, Theme.QuickSpeed)
        Util.Tween(MainFrame, {
            BackgroundTransparency = 1,
            Size = UDim2.new(0, 380, 0, 320)
        }, Theme.NormalSpeed)
        
        for _, child in ipairs(MainFrame:GetDescendants()) do
            if child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("TextBox") then
                Util.Tween(child, {TextTransparency = 1}, Theme.QuickSpeed)
            end
            if child:IsA("Frame") and child.BackgroundTransparency < 1 then
                Util.Tween(child, {BackgroundTransparency = 1}, Theme.QuickSpeed)
            end
            if child:IsA("ImageLabel") then
                Util.Tween(child, {ImageTransparency = 1}, Theme.QuickSpeed)
            end
            if child:IsA("UIStroke") then
                Util.Tween(child, {Transparency = 1}, Theme.QuickSpeed)
            end
        end
        
        task.delay(Theme.NormalSpeed + 0.1, function()
            ScreenGui:Destroy()
        end)
    end
    
    -- Button Callbacks
    table.insert(Connections, VerifyButton.MouseButton1Click:Connect(function()
        Util.Ripple(VerifyButton)
        local key = KeyInput.Text
        
        if key == "" then
            SetStatus("Please enter a key", Theme.Warning)
            return
        end
        
        SetStatus("Verifying...", Theme.TextSecondary)
        VerifyButton.Text = "..."
        
        task.spawn(function()
            local success, message = keyHandler:VerifyKey(key)
            
            if success then
                SetStatus(message, Theme.Success)
                VerifyButton.Text = "Success!"
                Util.Tween(VerifyButton, {BackgroundColor3 = Theme.Success}, Theme.QuickSpeed)
                
                getgenv().SCRIPT_KEY = key
                
                task.delay(1.2, function()
                    Close()
                    task.delay(0.4, onSuccess)
                end)
            else
                SetStatus(message, Theme.Error)
                VerifyButton.Text = "Verify Key"
                Util.Tween(VerifyButton, {BackgroundColor3 = Theme.Error}, Theme.QuickSpeed)
                task.delay(1.5, function()
                    Util.Tween(VerifyButton, {BackgroundColor3 = Theme.Accent}, Theme.QuickSpeed)
                end)
                onFailed(message)
            end
        end)
    end))
    
    table.insert(Connections, GetKeyButton.MouseButton1Click:Connect(function()
        Util.Ripple(GetKeyButton)
        SetStatus("Getting link...", Theme.TextSecondary)
        
        task.spawn(function()
            local success = keyHandler:CopyLink()
            if success then
                SetStatus("Link copied to clipboard!", Theme.Success)
                GetKeyButton.Text = "Copied!"
                task.delay(2, function()
                    GetKeyButton.Text = "Get Key"
                    SetStatus("", Theme.TextSecondary)
                end)
            else
                SetStatus("Failed to get link", Theme.Error)
            end
        end)
    end))
    
    table.insert(Connections, DiscordButton.MouseButton1Click:Connect(function()
        Util.Ripple(DiscordButton)
        pcall(function()
            (setclipboard or toclipboard or function() end)(discordLink)
        end)
        DiscordButton.Text = "Copied!"
        task.delay(1.5, function()
            DiscordButton.Text = "Join Discord"
        end)
    end))
    
    return {
        Destroy = function()
            getgenv().UI_CLOSED = true
            Close()
        end,
        SetStatus = SetStatus
    }
end

Kovari.Util = Util
Kovari.Theme = Theme
Kovari.Animate = Animate

_G.KovariInstance = Kovari
-- Main UI Initialization
function Kovari:Init(config)
    config = config or {}
    
    local toggleKey = config.ToggleKey or Enum.KeyCode.RightControl
    local discordInvite = config.Discord or "discord.gg/QcvddpVeTM"
    
    local Theme = self.Theme
    local Util = self.Util
    local Animate = self.Animate
    
    -- State
    local AllTabs = {}
    local CurrentTab = nil
    local UIVisible = true
    local Toggling = false
    local UIScaleValue = 100
    local Connections = {}
    
    -- Create ScreenGui
    local ScreenGui = Util.Create("ScreenGui", {
        Name = "KovariUI",
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        IgnoreGuiInset = true
    })
    
    pcall(function()
        if syn and syn.protect_gui then
            syn.protect_gui(ScreenGui)
            ScreenGui.Parent = CoreGui
        elseif gethui then
            ScreenGui.Parent = gethui()
        else
            ScreenGui.Parent = CoreGui
        end
    end)
    
    -- UI Scale
    local UIScale = Util.Create("UIScale", {
        Scale = 1,
        Parent = ScreenGui
    })
    
    -- Main Frame
    local Main = Util.Create("Frame", {
        Name = "Main",
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 580, 0, 380),
        BackgroundColor3 = Theme.Primary,
        ClipsDescendants = true,
        Parent = ScreenGui
    })
    Util.Corner(Main, Theme.CornerRadiusLarge)
    local MainStroke = Util.Stroke(Main, Theme.Border, 1)
    local MainShadow = Util.Shadow(Main, 6, 0.5)
    
    -- Top Bar
    local TopBar = Util.Create("Frame", {
        Size = UDim2.new(1, 0, 0, 52),
        BackgroundColor3 = Theme.Secondary,
        Parent = Main
    })
    Util.Corner(TopBar, Theme.CornerRadiusLarge)
    
    local TopBarBottom = Util.Create("Frame", {
        Size = UDim2.new(1, 0, 0, 12),
        Position = UDim2.new(0, 0, 1, -12),
        BackgroundColor3 = Theme.Secondary,
        BorderSizePixel = 0,
        Parent = TopBar
    })
    
    local TopBarDivider = Util.Create("Frame", {
        Size = UDim2.new(1, -28, 0, 1),
        Position = UDim2.new(0, 14, 1, 0),
        BackgroundColor3 = Theme.Separator,
        BorderSizePixel = 0,
        Parent = TopBar
    })
    
    -- Logo
    local LogoFrame = Util.Create("Frame", {
        Size = UDim2.new(0, 32, 0, 32),
        Position = UDim2.new(0, 14, 0.5, -16),
        BackgroundColor3 = Theme.Accent,
        Parent = TopBar
    })
    Util.Corner(LogoFrame, 8)
    
    local LogoImage = Util.Create("ImageLabel", {
        Size = UDim2.new(1, -6, 1, -6),
        Position = UDim2.new(0, 3, 0, 3),
        BackgroundTransparency = 1,
        Image = "rbxassetid://104988871729944",
        ScaleType = Enum.ScaleType.Fit,
        Parent = LogoFrame
    })
    
    local TitleLabel = Util.Create("TextLabel", {
        Size = UDim2.new(0, 80, 0, 20),
        Position = UDim2.new(0, 54, 0.5, -10),
        BackgroundTransparency = 1,
        Font = Theme.FontBold,
        Text = "KOVARI",
        TextColor3 = Theme.TextPrimary,
        TextSize = 15,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = TopBar
    })
    
    -- Status Indicator
    local StatusContainer = Util.Create("Frame", {
        AnchorPoint = Vector2.new(1, 0.5),
        Position = UDim2.new(1, -14, 0.5, 0),
        Size = UDim2.new(0, 180, 0, 32),
        BackgroundTransparency = 1,
        Parent = TopBar
    })
    
    local StatusDot = Util.Create("Frame", {
        AnchorPoint = Vector2.new(1, 0.5),
        Size = UDim2.new(0, 7, 0, 7),
        Position = UDim2.new(1, 0, 0.5, 6),
        BackgroundColor3 = Theme.Success,
        Parent = StatusContainer
    })
    Util.Corner(StatusDot, 4)
    
    local StatusText = Util.Create("TextLabel", {
        AnchorPoint = Vector2.new(1, 0),
        Size = UDim2.new(1, -12, 0, 14),
        Position = UDim2.new(1, -12, 0.5, 0),
        BackgroundTransparency = 1,
        Font = Theme.FontRegular,
        Text = "Connected",
        TextColor3 = Theme.Success,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Right,
        Parent = StatusContainer
    })
    
    local GameLabel = Util.Create("TextLabel", {
        AnchorPoint = Vector2.new(1, 1),
        Size = UDim2.new(1, 0, 0, 14),
        Position = UDim2.new(1, 0, 0.5, -2),
        BackgroundTransparency = 1,
        Font = Theme.FontSemibold,
        Text = Util.GetGameName(),
        TextColor3 = Theme.TextPrimary,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Right,
        TextTruncate = Enum.TextTruncate.AtEnd,
        Parent = StatusContainer
    })
    
    -- Tab Bar
    local TabBar = Util.Create("Frame", {
        Size = UDim2.new(1, -28, 0, 32),
        Position = UDim2.new(0, 14, 0, 56),
        BackgroundTransparency = 1,
        ClipsDescendants = true,
        Parent = Main
    })
    
    local TabLayout = Util.Create("UIListLayout", {
        FillDirection = Enum.FillDirection.Horizontal,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 4),
        Parent = TabBar
    })
    
    -- Content Container
    local ContentContainer = Util.Create("ScrollingFrame", {
        Size = UDim2.new(1, -28, 1, -100),
        Position = UDim2.new(0, 14, 0, 92),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = 3,
        ScrollBarImageColor3 = Theme.Accent,
        ScrollBarImageTransparency = 0.4,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        ScrollingDirection = Enum.ScrollingDirection.Y,
        Parent = Main
    })
    
    -- Dragging
    local dragging = false
    local dragStart, startPos
    local targetPos = Main.Position
    
    table.insert(Connections, TopBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = Main.Position
        end
    end))
    
    table.insert(Connections, TopBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end))
    
    table.insert(Connections, UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            targetPos = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end))
    
    table.insert(Connections, RunService.RenderStepped:Connect(function()
        if dragging then
            Main.Position = Main.Position:Lerp(targetPos, 0.15)
        end
    end))
    
    -- Row Divider Helper
    local function CreateRowDivider(parent)
        return Util.Create("Frame", {
            AnchorPoint = Vector2.new(0, 1),
            Size = UDim2.new(1, 0, 0, 1),
            Position = UDim2.new(0, 0, 1, 0),
            BackgroundColor3 = Theme.Separator,
            BorderSizePixel = 0,
            Parent = parent
        })
    end
    
    -- Section Creator
    local function CreateSection(parent, sectionName)
        local section = {}
        
        local SectionFrame = Util.Create("Frame", {
            Size = UDim2.new(1, 0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundColor3 = Theme.Secondary,
            Parent = parent
        })
        Util.Corner(SectionFrame, Theme.CornerRadius)
        Util.Stroke(SectionFrame, Theme.Border, 1)
        
        local SectionHeader = Util.Create("Frame", {
            Size = UDim2.new(1, 0, 0, 36),
            BackgroundTransparency = 1,
            Parent = SectionFrame
        })
        
        local SectionTitle = Util.Create("TextLabel", {
            Size = UDim2.new(1, -24, 1, 0),
            Position = UDim2.new(0, 12, 0, 0),
            BackgroundTransparency = 1,
            Font = Theme.FontBold,
            Text = sectionName or "Section",
            TextColor3 = Theme.TextPrimary,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = SectionHeader
        })
        
        local SectionDivider = Util.Create("Frame", {
            Size = UDim2.new(1, -24, 0, 1),
            Position = UDim2.new(0, 12, 1, 0),
            BackgroundColor3 = Theme.Separator,
            BorderSizePixel = 0,
            Parent = SectionHeader
        })
        
        local SectionContent = Util.Create("Frame", {
            Size = UDim2.new(1, -24, 0, 0),
            Position = UDim2.new(0, 12, 0, 40),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundTransparency = 1,
            Parent = SectionFrame
        })
        
        local ContentLayout = Util.Create("UIListLayout", {
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 0),
            Parent = SectionContent
        })
        
        local BottomPadding = Util.Create("Frame", {
            Size = UDim2.new(1, 0, 0, 8),
            BackgroundTransparency = 1,
            LayoutOrder = 9999,
            Parent = SectionContent
        })
        
        -- Toggle Component
        function section:AddToggle(cfg)
            cfg = cfg or {}
            local toggleName = cfg.Name or "Toggle"
            local default = cfg.Default or false
            local callback = cfg.Callback or function() end
            
            local state = default
            
            local Row = Util.Create("Frame", {
                Size = UDim2.new(1, 0, 0, 42),
                BackgroundTransparency = 1,
                ClipsDescendants = false,
                ZIndex = 5,
                Parent = SectionContent
            })
            
            local Label = Util.Create("TextLabel", {
                Size = UDim2.new(0.65, 0, 1, 0),
                BackgroundTransparency = 1,
                Font = Theme.FontMedium,
                Text = toggleName,
                TextColor3 = Theme.TextPrimary,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = Row
            })
            
            local Switch = Util.Create("Frame", {
                AnchorPoint = Vector2.new(1, 0.5),
                Position = UDim2.new(1, 0, 0.5, 0),
                Size = UDim2.new(0, 44, 0, 26),
                BackgroundColor3 = state and Theme.Accent or Theme.Fill,
                Parent = Row
            })
            Util.Corner(Switch, 13)
            
            local Knob = Util.Create("Frame", {
                AnchorPoint = Vector2.new(0, 0.5),
                Position = state and UDim2.new(1, -22, 0.5, 0) or UDim2.new(0, 4, 0.5, 0),
                Size = UDim2.new(0, 18, 0, 18),
                BackgroundColor3 = Theme.TextPrimary,
                Parent = Switch
            })
            Util.Corner(Knob, 9)
            
            local SwitchButton = Util.Create("TextButton", {
                Size = UDim2.new(1, 0, 1, 0),
                BackgroundTransparency = 1,
                Text = "",
                Parent = Switch
            })
            
            CreateRowDivider(Row)
            
            table.insert(Connections, SwitchButton.MouseButton1Click:Connect(function()
                state = not state
                
                Util.Tween(Switch, {
                    BackgroundColor3 = state and Theme.Accent or Theme.Fill
                }, Theme.QuickSpeed)
                
                local targetPos = state and UDim2.new(1, -22, 0.5, 0) or UDim2.new(0, 4, 0.5, 0)
                Util.Spring(Knob, {Position = targetPos}, Theme.QuickSpeed * 1.5)
                
                local originalSize = Knob.Size
                Util.Tween(Knob, {Size = UDim2.new(0, 20, 0, 20)}, Theme.QuickSpeed / 2)
                task.delay(Theme.QuickSpeed / 2, function()
                    Util.Spring(Knob, {Size = originalSize}, Theme.QuickSpeed)
                end)
                
                callback(state)
            end))
            
            return {
                SetState = function(_, newState)
                    state = newState
                    Util.Tween(Switch, {BackgroundColor3 = state and Theme.Accent or Theme.Fill}, Theme.QuickSpeed)
                    Knob.Position = state and UDim2.new(1, -22, 0.5, 0) or UDim2.new(0, 4, 0.5, 0)
                end,
                GetState = function()
                    return state
                end
            }
        end
        
        -- Slider Component
        function section:AddSlider(cfg)
            cfg = cfg or {}
            local sliderName = cfg.Name or "Slider"
            local min = cfg.Min or 0
            local max = cfg.Max or 100
            local default = cfg.Default or min
            local suffix = cfg.Suffix or ""
            local callback = cfg.Callback or function() end
            
            local value = math.clamp(default, min, max)
            
            local Row = Util.Create("Frame", {
                Size = UDim2.new(1, 0, 0, 52),
                BackgroundTransparency = 1,
                Parent = SectionContent
            })
            
            local Label = Util.Create("TextLabel", {
                Size = UDim2.new(0.5, 0, 0, 22),
                BackgroundTransparency = 1,
                Font = Theme.FontMedium,
                Text = sliderName,
                TextColor3 = Theme.TextPrimary,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = Row
            })
            
            local ValueLabel = Util.Create("TextLabel", {
                AnchorPoint = Vector2.new(1, 0),
                Size = UDim2.new(0.5, 0, 0, 22),
                Position = UDim2.new(1, 0, 0, 0),
                BackgroundTransparency = 1,
                Font = Theme.FontBold,
                Text = tostring(value) .. suffix,
                TextColor3 = Theme.Accent,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Right,
                Parent = Row
            })
            
            local Track = Util.Create("Frame", {
                Size = UDim2.new(1, 0, 0, 6),
                Position = UDim2.new(0, 0, 0, 28),
                BackgroundColor3 = Theme.Fill,
                Parent = Row
            })
            Util.Corner(Track, 3)
            
            local Fill = Util.Create("Frame", {
                Size = UDim2.new((value - min) / (max - min), 0, 1, 0),
                BackgroundColor3 = Theme.Accent,
                Parent = Track
            })
            Util.Corner(Fill, 3)
            
            local SliderKnob = Util.Create("Frame", {
                AnchorPoint = Vector2.new(0.5, 0.5),
                Position = UDim2.new((value - min) / (max - min), 0, 0.5, 0),
                Size = UDim2.new(0, 16, 0, 16),
                BackgroundColor3 = Theme.TextPrimary,
                ZIndex = 2,
                Parent = Track
            })
            Util.Corner(SliderKnob, 8)
            Util.Shadow(SliderKnob, 2, 0.7)
            
            local Hitbox = Util.Create("TextButton", {
                Size = UDim2.new(1, 0, 1, 20),
                Position = UDim2.new(0, 0, 0, -10),
                BackgroundTransparency = 1,
                Text = "",
                Parent = Track
            })
            
            CreateRowDivider(Row)
            
            local sliderDragging = false
            
            local function UpdateSlider(input)
                local pct = math.clamp((input.Position.X - Track.AbsolutePosition.X) / Track.AbsoluteSize.X, 0, 1)
                value = math.floor(min + (max - min) * pct)
                ValueLabel.Text = tostring(value) .. suffix
                
                Util.Tween(Fill, {Size = UDim2.new(pct, 0, 1, 0)}, Theme.QuickSpeed / 2)
                Util.Tween(SliderKnob, {Position = UDim2.new(pct, 0, 0.5, 0)}, Theme.QuickSpeed / 2)
                
                callback(value)
            end
            
            table.insert(Connections, Hitbox.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    sliderDragging = true
                    UpdateSlider(input)
                end
            end))
            
            table.insert(Connections, Hitbox.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    sliderDragging = false
                end
            end))
            
            table.insert(Connections, UserInputService.InputChanged:Connect(function(input)
                if sliderDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    UpdateSlider(input)
                end
            end))
            
            return {
                SetValue = function(_, newValue)
                    value = math.clamp(newValue, min, max)
                    local pct = (value - min) / (max - min)
                    ValueLabel.Text = tostring(value) .. suffix
                    Fill.Size = UDim2.new(pct, 0, 1, 0)
                    SliderKnob.Position = UDim2.new(pct, 0, 0.5, 0)
                end,
                GetValue = function()
                    return value
                end
            }
        end
        
        -- Button Component
        function section:AddButton(cfg)
            cfg = cfg or {}
            local buttonName = cfg.Name or "Button"
            local buttonText = cfg.ButtonText or "Execute"
            local callback = cfg.Callback or function() end
            
            local Row = Util.Create("Frame", {
                Size = UDim2.new(1, 0, 0, 42),
                BackgroundTransparency = 1,
                Parent = SectionContent
            })
            
            local Label = Util.Create("TextLabel", {
                Size = UDim2.new(0.6, 0, 1, 0),
                BackgroundTransparency = 1,
                Font = Theme.FontMedium,
                Text = buttonName,
                TextColor3 = Theme.TextPrimary,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = Row
            })
            
            local Button = Util.Create("TextButton", {
                AnchorPoint = Vector2.new(1, 0.5),
                Position = UDim2.new(1, 0, 0.5, 0),
                Size = UDim2.new(0, 70, 0, 28),
                BackgroundColor3 = Theme.Accent,
                Font = Theme.FontSemibold,
                Text = buttonText,
                TextColor3 = Theme.TextPrimary,
                TextSize = 11,
                AutoButtonColor = false,
                ClipsDescendants = true,
                Parent = Row
            })
            Util.Corner(Button, Theme.CornerRadiusSmall)
            
            CreateRowDivider(Row)
            
            local hovered, pressed = false, false
            
            local function UpdateState()
                local targetColor
                local targetSize = Button.Size
                
                if pressed then
                    targetColor = Theme.AccentDark
                    Util.Tween(Button, {
                        BackgroundColor3 = targetColor,
                        Size = UDim2.new(targetSize.X.Scale, targetSize.X.Offset - 2, 0, 26)
                    }, Theme.QuickSpeed / 2)
                elseif hovered then
                    targetColor = Theme.AccentLight
                    Util.Tween(Button, {
                        BackgroundColor3 = targetColor,
                        Size = UDim2.new(0, 72, 0, 30)
                    }, Theme.QuickSpeed)
                else
                    targetColor = Theme.Accent
                    Util.Tween(Button, {
                        BackgroundColor3 = targetColor,
                        Size = UDim2.new(0, 70, 0, 28)
                    }, Theme.QuickSpeed)
                end
            end
            
            table.insert(Connections, Button.MouseEnter:Connect(function()
                hovered = true
                UpdateState()
            end))
            
            table.insert(Connections, Button.MouseLeave:Connect(function()
                hovered = false
                pressed = false
                UpdateState()
            end))
            
            table.insert(Connections, Button.MouseButton1Down:Connect(function()
                pressed = true
                UpdateState()
            end))
            
            table.insert(Connections, Button.MouseButton1Up:Connect(function()
                pressed = false
                UpdateState()
            end))
            
            table.insert(Connections, Button.MouseButton1Click:Connect(function()
                Util.Ripple(Button)
                callback()
            end))
        end
        
        -- Dropdown Component
        function section:AddDropdown(cfg)
            cfg = cfg or {}
            local dropdownName = cfg.Name or "Dropdown"
            local options = cfg.Options or {}
            local default = cfg.Default or (options[1] or "Select")
            local callback = cfg.Callback or function() end
            
            local selected = default
            local isOpen = false
            
            local Row = Util.Create("Frame", {
                Size = UDim2.new(1, 0, 0, 42),
                BackgroundTransparency = 1,
                ClipsDescendants = false,
                ZIndex = 5,
                Parent = SectionContent
            })
            
            local Label = Util.Create("TextLabel", {
                Size = UDim2.new(0.4, 0, 0, 42),
                BackgroundTransparency = 1,
                Font = Theme.FontMedium,
                Text = dropdownName,
                TextColor3 = Theme.TextPrimary,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = Row
            })
            
            local DropButton = Util.Create("TextButton", {
                AnchorPoint = Vector2.new(1, 0),
                Position = UDim2.new(1, 0, 0, 7),
                Size = UDim2.new(0, 130, 0, 28),
                BackgroundColor3 = Theme.Fill,
                Font = Theme.FontMedium,
                Text = selected,
                TextColor3 = Theme.TextPrimary,
                TextSize = 11,
                AutoButtonColor = false,
                Parent = Row
            })
            Util.Corner(DropButton, Theme.CornerRadiusSmall)
            Util.Stroke(DropButton, Theme.Border)
            
            local Arrow = Util.Create("TextLabel", {
                AnchorPoint = Vector2.new(1, 0.5),
                Size = UDim2.new(0, 20, 1, 0),
                Position = UDim2.new(1, -4, 0.5, 0),
                BackgroundTransparency = 1,
                Font = Theme.FontBold,
                Text = "",
                TextColor3 = Theme.TextSecondary,
                TextSize = 8,
                Parent = DropButton
            })
            
            local DropdownList = Util.Create("Frame", {
                AnchorPoint = Vector2.new(1, 0),
                Position = UDim2.new(1, 0, 0, 38),
                Size = UDim2.new(0, 130, 0, 0),
                BackgroundColor3 = Theme.Tertiary,
                ClipsDescendants = true,
                Visible = false,
                ZIndex = 9999,
                Parent = ScreenGui
            })
            Util.Corner(DropdownList, Theme.CornerRadiusSmall)
            Util.Stroke(DropdownList, Theme.Border)
            
            local ListLayout = Util.Create("UIListLayout", {
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = UDim.new(0, 2),
                Parent = DropdownList
            })
            
            Util.Create("UIPadding", {
                PaddingTop = UDim.new(0, 4),
                PaddingBottom = UDim.new(0, 4),
                PaddingLeft = UDim.new(0, 4),
                PaddingRight = UDim.new(0, 4),
                Parent = DropdownList
            })
            
            CreateRowDivider(Row)
            
            local function CloseDropdown()
                isOpen = false
                
                Util.Tween(DropdownList, {
                    Size = UDim2.new(0, 130, 0, 0),
                    BackgroundTransparency = 1
                }, Theme.QuickSpeed * 1.5)
                
                Util.Spring(Arrow, {Rotation = 0}, Theme.QuickSpeed)
                
                task.delay(Theme.QuickSpeed * 1.5, function()
                    if not isOpen then
                        DropdownList.Visible = false
                    end
                end)
            end
            
            local function OpenDropdown()
                isOpen = true
                
                local buttonPos = DropButton.AbsolutePosition
                local buttonSize = DropButton.AbsoluteSize
                DropdownList.Position = UDim2.new(0, buttonPos.X + buttonSize.X, 0, buttonPos.Y + buttonSize.Y + 2)
                DropdownList.Visible = true
                
                local targetHeight = math.min(#options * 26 + 10, 180)
                
                DropdownList.BackgroundTransparency = 1
                Util.Tween(DropdownList, {BackgroundTransparency = 0}, Theme.QuickSpeed)
                Util.Spring(DropdownList, {
                    Size = UDim2.new(0, 130, 0, targetHeight)
                }, Theme.NormalSpeed * 0.8)
                
                Util.Spring(Arrow, {Rotation = 180}, Theme.QuickSpeed)
            end
            
            local function PopulateOptions()
                for _, child in ipairs(DropdownList:GetChildren()) do
                    if child:IsA("TextButton") then
                        child:Destroy()
                    end
                end
                
                for _, option in ipairs(options) do
                    local OptionBtn = Util.Create("TextButton", {
                        Size = UDim2.new(1, 0, 0, 24),
                        BackgroundColor3 = Theme.Fill,
                        BackgroundTransparency = 1,
                        Font = Theme.FontMedium,
                        Text = option,
                        TextColor3 = Theme.TextSecondary,
                        TextSize = 11,
                        AutoButtonColor = false,
                        ZIndex = 11,
                        Parent = DropdownList
                    })
                    Util.Corner(OptionBtn, 4)
                    
                    OptionBtn.MouseEnter:Connect(function()
                        Util.Tween(OptionBtn, {BackgroundTransparency = 0, TextColor3 = Theme.TextPrimary}, Theme.QuickSpeed)
                    end)
                    
                    OptionBtn.MouseLeave:Connect(function()
                        Util.Tween(OptionBtn, {BackgroundTransparency = 1, TextColor3 = Theme.TextSecondary}, Theme.QuickSpeed)
                    end)
                    
                    OptionBtn.MouseButton1Click:Connect(function()
                        selected = option
                        DropButton.Text = selected
                        CloseDropdown()
                        callback(selected)
                    end)
                end
            end
            
            PopulateOptions()
            
            table.insert(Connections, DropButton.MouseButton1Click:Connect(function()
                if isOpen then
                    CloseDropdown()
                else
                    OpenDropdown()
                end
            end))
            
            table.insert(Connections, DropButton.MouseEnter:Connect(function()
                Util.Tween(DropButton, {BackgroundColor3 = Theme.FillHover}, Theme.QuickSpeed)
            end))
            
            table.insert(Connections, DropButton.MouseLeave:Connect(function()
                Util.Tween(DropButton, {BackgroundColor3 = Theme.Fill}, Theme.QuickSpeed)
            end))
            
            return {
                SetSelected = function(_, newOption)
                    selected = newOption
                    DropButton.Text = selected
                end,
                GetSelected = function()
                    return selected
                end,
                Refresh = function(_, newOptions)
                    options = newOptions
                    PopulateOptions()
                end
            }
        end
        
        -- Label Component
        function section:AddLabel(cfg)
            cfg = cfg or {}
            local text = cfg.Text or "Label"
            
            local Row = Util.Create("Frame", {
                Size = UDim2.new(1, 0, 0, 32),
                BackgroundTransparency = 1,
                Parent = SectionContent
            })
            
            local Label = Util.Create("TextLabel", {
                Size = UDim2.new(1, 0, 1, 0),
                BackgroundTransparency = 1,
                Font = Theme.FontMedium,
                Text = text,
                TextColor3 = Theme.TextSecondary,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = Row
            })
            
            return {
                SetText = function(_, newText)
                    Label.Text = newText
                end
            }
        end
        
        return section
    end
    
    -- Tab Creator
    local function CreateTab(name, layoutOrder, isDefault)
        local tab = {}
        
        local TabButton = Util.Create("TextButton", {
            Size = UDim2.new(0, 0, 1, 0),
            AutomaticSize = Enum.AutomaticSize.X,
            BackgroundColor3 = Theme.Fill,
            BackgroundTransparency = 1,
            Font = Theme.FontSemibold,
            Text = "  " .. name .. "  ",
            TextColor3 = Theme.TextSecondary,
            TextSize = 12,
            AutoButtonColor = false,
            LayoutOrder = layoutOrder or 0,
            Parent = TabBar
        })
        Util.Corner(TabButton, Theme.CornerRadiusSmall)
        
        local TabContent = Util.Create("Frame", {
            Size = UDim2.new(1, 0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundTransparency = 1,
            Visible = false,
            Parent = ContentContainer
        })
        
        local ContentLayout = Util.Create("UIListLayout", {
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 8),
            Parent = TabContent
        })
        
        tab.Button = TabButton
        tab.Content = TabContent
        tab.Name = name
        
        table.insert(AllTabs, tab)
        
        local function SelectTab()
            if CurrentTab == tab then return end
            
            if CurrentTab then
                Util.Tween(CurrentTab.Button, {
                    BackgroundTransparency = 1,
                    TextColor3 = Theme.TextSecondary
                }, Theme.QuickSpeed)
                CurrentTab.Content.Visible = false
            end
            
            CurrentTab = tab
            Util.Tween(TabButton, {
                BackgroundTransparency = 0,
                TextColor3 = Theme.TextPrimary
            }, Theme.QuickSpeed)
            TabContent.Visible = true
        end
        
        table.insert(Connections, TabButton.MouseButton1Click:Connect(SelectTab))
        
        table.insert(Connections, TabButton.MouseEnter:Connect(function()
            if CurrentTab ~= tab then
                Util.Tween(TabButton, {BackgroundTransparency = 0.5}, Theme.QuickSpeed)
            end
        end))
        
        table.insert(Connections, TabButton.MouseLeave:Connect(function()
            if CurrentTab ~= tab then
                Util.Tween(TabButton, {BackgroundTransparency = 1}, Theme.QuickSpeed)
            end
        end))
        
        if isDefault or #AllTabs == 1 then
            task.defer(SelectTab)
        end
        
        return tab
    end
    
    -- Profile Tab
    local function CreateProfileTab()
        local profileTab = CreateTab("Profile", -100, true)
        
        local ProfileContent = Util.Create("Frame", {
            Size = UDim2.new(1, 0, 0, 230),
            BackgroundTransparency = 1,
            Parent = profileTab.Content
        })
        
        local LeftPanel = Util.Create("Frame", {
            Size = UDim2.new(0, 160, 1, 0),
            BackgroundColor3 = Theme.Secondary,
            Parent = ProfileContent
        })
        Util.Corner(LeftPanel, Theme.CornerRadius)
        Util.Stroke(LeftPanel, Theme.Border)
        
        local AvatarFrame = Util.Create("Frame", {
            AnchorPoint = Vector2.new(0.5, 0),
            Size = UDim2.new(0, 90, 0, 90),
            Position = UDim2.new(0.5, 0, 0, 16),
            BackgroundColor3 = Theme.Fill,
            Parent = LeftPanel
        })
        Util.Corner(AvatarFrame, Theme.CornerRadius)
        Util.Stroke(AvatarFrame, Theme.Border)
        
        local Avatar = Util.Create("ImageLabel", {
            Size = UDim2.new(1, -8, 1, -8),
            Position = UDim2.new(0, 4, 0, 4),
            BackgroundTransparency = 1,
            Image = "rbxthumb://type=AvatarHeadShot&id=" .. LocalPlayer.UserId .. "&w=420&h=420",
            Parent = AvatarFrame
        })
        Util.Corner(Avatar, 8)
        
        local DisplayName = Util.Create("TextLabel", {
            AnchorPoint = Vector2.new(0.5, 0),
            Size = UDim2.new(1, -20, 0, 18),
            Position = UDim2.new(0.5, 0, 0, 114),
            BackgroundTransparency = 1,
            Font = Theme.FontBold,
            Text = LocalPlayer.DisplayName,
            TextColor3 = Theme.TextPrimary,
            TextSize = 14,
            TextTruncate = Enum.TextTruncate.AtEnd,
            Parent = LeftPanel
        })
        
        local Username = Util.Create("TextLabel", {
            AnchorPoint = Vector2.new(0.5, 0),
            Size = UDim2.new(1, -20, 0, 14),
            Position = UDim2.new(0.5, 0, 0, 134),
            BackgroundTransparency = 1,
            Font = Theme.FontMedium,
            Text = "@" .. LocalPlayer.Name,
            TextColor3 = Theme.TextSecondary,
            TextSize = 11,
            TextTruncate = Enum.TextTruncate.AtEnd,
            Parent = LeftPanel
        })
        
        local AccentBar = Util.Create("Frame", {
            AnchorPoint = Vector2.new(0.5, 0),
            Size = UDim2.new(0, 40, 0, 3),
            Position = UDim2.new(0.5, 0, 0, 156),
            BackgroundColor3 = Theme.Accent,
            Parent = LeftPanel
        })
        Util.Corner(AccentBar, 2)
        
        local DiscordFrame = Util.Create("Frame", {
            AnchorPoint = Vector2.new(0.5, 1),
            Size = UDim2.new(1, -20, 0, 34),
            Position = UDim2.new(0.5, 0, 1, -10),
            BackgroundColor3 = Theme.Fill,
            Parent = LeftPanel
        })
        Util.Corner(DiscordFrame, Theme.CornerRadiusSmall)
        Util.Stroke(DiscordFrame, Theme.Border)
        
        local DiscordIcon = Util.Create("TextLabel", {
            Size = UDim2.new(0, 20, 1, 0),
            Position = UDim2.new(0, 8, 0, 0),
            BackgroundTransparency = 1,
            Font = Theme.FontBold,
            Text = "DC",
            TextColor3 = Theme.TextTertiary,
            TextSize = 8,
            Parent = DiscordFrame
        })
        
        local DiscordText = Util.Create("TextLabel", {
            Size = UDim2.new(1, -34, 1, 0),
            Position = UDim2.new(0, 28, 0, 0),
            BackgroundTransparency = 1,
            Font = Theme.FontMedium,
            Text = discordInvite,
            TextColor3 = Theme.TextSecondary,
            TextSize = 10,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextTruncate = Enum.TextTruncate.AtEnd,
            Parent = DiscordFrame
        })
        
        local DiscordButton = Util.Create("TextButton", {
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Text = "",
            Parent = DiscordFrame
        })
        
        local copying = false
        table.insert(Connections, DiscordButton.MouseButton1Click:Connect(function()
            if copying then return end
            copying = true
            pcall(function()
                (setclipboard or toclipboard or function() end)(discordInvite)
            end)
            
            local orig = DiscordText.Text
            DiscordText.Text = "Copied!"
            DiscordText.TextColor3 = Theme.Success
            Util.Tween(DiscordFrame, {BackgroundColor3 = Theme.AccentMuted}, Theme.QuickSpeed)
            
            task.delay(1.2, function()
                DiscordText.Text = orig
                DiscordText.TextColor3 = Theme.TextSecondary
                Util.Tween(DiscordFrame, {BackgroundColor3 = Theme.Fill}, Theme.QuickSpeed)
                copying = false
            end)
        end))
        
        table.insert(Connections, DiscordButton.MouseEnter:Connect(function()
            if not copying then
                Util.Tween(DiscordFrame, {BackgroundColor3 = Theme.FillHover}, Theme.QuickSpeed)
            end
        end))
        
        table.insert(Connections, DiscordButton.MouseLeave:Connect(function()
            if not copying then
                Util.Tween(DiscordFrame, {BackgroundColor3 = Theme.Fill}, Theme.QuickSpeed)
            end
        end))
        
        local RightPanel = Util.Create("Frame", {
            AnchorPoint = Vector2.new(1, 0),
            Position = UDim2.new(1, 0, 0, 0),
            Size = UDim2.new(1, -170, 1, 0),
            BackgroundColor3 = Theme.Secondary,
            Parent = ProfileContent
        })
        Util.Corner(RightPanel, Theme.CornerRadius)
        Util.Stroke(RightPanel, Theme.Border)
        
        local InfoHeader = Util.Create("TextLabel", {
            Size = UDim2.new(1, -24, 0, 22),
            Position = UDim2.new(0, 12, 0, 12),
            BackgroundTransparency = 1,
            Font = Theme.FontBold,
            Text = "Account Information",
            TextColor3 = Theme.TextPrimary,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = RightPanel
        })
        
        local InfoDivider = Util.Create("Frame", {
            Size = UDim2.new(1, -24, 0, 1),
            Position = UDim2.new(0, 12, 0, 38),
            BackgroundColor3 = Theme.Separator,
            BorderSizePixel = 0,
            Parent = RightPanel
        })
        
        local InfoList = Util.Create("Frame", {
            Size = UDim2.new(1, -24, 1, -52),
            Position = UDim2.new(0, 12, 0, 44),
            BackgroundTransparency = 1,
            Parent = RightPanel
        })
        
        Util.Create("UIListLayout", {
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 0),
            Parent = InfoList
        })
        
        local function InfoRow(label, value)
            local row = Util.Create("Frame", {
                Size = UDim2.new(1, 0, 0, 34),
                BackgroundTransparency = 1,
                Parent = InfoList
            })
            
            Util.Create("TextLabel", {
                Size = UDim2.new(0.45, 0, 1, 0),
                BackgroundTransparency = 1,
                Font = Theme.FontMedium,
                Text = label,
                TextColor3 = Theme.TextSecondary,
                TextSize = 11,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = row
            })
            
            Util.Create("TextLabel", {
                AnchorPoint = Vector2.new(1, 0),
                Size = UDim2.new(0.53, 0, 1, 0),
                Position = UDim2.new(1, 0, 0, 0),
                BackgroundTransparency = 1,
                Font = Theme.FontSemibold,
                Text = value,
                TextColor3 = Theme.TextPrimary,
                TextSize = 11,
                TextXAlignment = Enum.TextXAlignment.Right,
                TextTruncate = Enum.TextTruncate.AtEnd,
                Parent = row
            })
            
            Util.Create("Frame", {
                AnchorPoint = Vector2.new(0, 1),
                Size = UDim2.new(1, 0, 0, 1),
                Position = UDim2.new(0, 0, 1, 0),
                BackgroundColor3 = Theme.Separator,
                BorderSizePixel = 0,
                Parent = row
            })
        end
        
        InfoRow("User ID", tostring(LocalPlayer.UserId))
        InfoRow("Account Age", tostring(LocalPlayer.AccountAge) .. " days")
        InfoRow("Join Date", Util.FormatDate(os.time() - (LocalPlayer.AccountAge * 86400)))
        InfoRow("Current Game", Util.GetGameName())
        InfoRow("Server ID", game.JobId ~= "" and (game.JobId:sub(1, 14) .. "...") or "Studio")
        
        return profileTab
    end
    
    CreateProfileTab()
    
    -- Toggle Visibility
    table.insert(Connections, UserInputService.InputBegan:Connect(function(input, gpe)
        if not gpe and input.KeyCode == toggleKey and not Toggling then
            Toggling = true
            UIVisible = not UIVisible
            
            if UIVisible then
                Main.Visible = true
                Main.Size = UDim2.new(0, 580, 0, 0)
                
                Util.Spring(Main, {
                    Size = UDim2.new(0, 580, 0, 380)
                }, Theme.SpringSpeed)
                
                task.delay(Theme.SpringSpeed, function()
                    Toggling = false
                end)
            else
                Util.Tween(Main, {
                    Size = UDim2.new(0, 580, 0, 0)
                }, Theme.NormalSpeed)
                
                task.delay(Theme.NormalSpeed, function()
                    if not UIVisible then
                        Main.Visible = false
                    end
                    Toggling = false
                end)
            end
        end
    end))
    
    -- API
    local API = {
        Gui = ScreenGui,
        Main = Main,
        Theme = Theme,
        
        CreateTab = function(_, name, isDefault)
            local tab = CreateTab(name, #AllTabs, isDefault)
            
            local TabAPI = {}
            
            function TabAPI:AddSection(sectionName)
                return CreateSection(tab.Content, sectionName)
            end
            
            return TabAPI
        end,
        
        SetStatus = function(_, text, color)
            StatusText.Text = text
            StatusText.TextColor3 = color or Theme.TextSecondary
            StatusDot.BackgroundColor3 = color or Theme.TextSecondary
        end,
        
        SetToggleKey = function(_, key)
            toggleKey = key
        end,
        
        SetScale = function(_, scale)
            UIScaleValue = scale
            Util.Tween(UIScale, {Scale = scale / 100}, Theme.QuickSpeed)
        end,
        
        Destroy = function(_)
            Toggling = true
            
            for _, conn in ipairs(Connections) do
                conn:Disconnect()
            end
            
            Util.Tween(MainShadow, {ImageTransparency = 1}, Theme.QuickSpeed)
            Util.Tween(MainStroke, {Transparency = 1}, Theme.QuickSpeed)
            Util.Tween(Main, {
                Size = UDim2.new(0, 540, 0, 0)
            }, Theme.NormalSpeed)
            
            task.delay(Theme.NormalSpeed + 0.1, function()
                ScreenGui:Destroy()
                _G.KovariLoaded = false
                _G.KovariInstance = nil
            end)
        end,
        
        Notify = function(_, title, message, duration)
            duration = duration or 3
            
            local NotifFrame = Util.Create("Frame", {
                AnchorPoint = Vector2.new(1, 1),
                Position = UDim2.new(1, 20, 1, -20),
                Size = UDim2.new(0, 280, 0, 70),
                BackgroundColor3 = Theme.Secondary,
                Parent = ScreenGui
            })
            Util.Corner(NotifFrame, Theme.CornerRadius)
            local NotifStroke = Util.Stroke(NotifFrame, Theme.Border, 1)
            local NotifShadow = Util.Shadow(NotifFrame, 4, 0.6)
            
            local NotifTitle = Util.Create("TextLabel", {
                Size = UDim2.new(1, -20, 0, 20),
                Position = UDim2.new(0, 10, 0, 12),
                BackgroundTransparency = 1,
                Font = Theme.FontBold,
                Text = title or "Notification",
                TextColor3 = Theme.TextPrimary,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = NotifFrame
            })
            
            local NotifMessage = Util.Create("TextLabel", {
                Size = UDim2.new(1, -20, 0, 30),
                Position = UDim2.new(0, 10, 0, 34),
                BackgroundTransparency = 1,
                Font = Theme.FontMedium,
                Text = message or "",
                TextColor3 = Theme.TextSecondary,
                TextSize = 11,
                TextXAlignment = Enum.TextXAlignment.Left,
                TextWrapped = true,
                Parent = NotifFrame
            })
            
            Util.Spring(NotifFrame, {Position = UDim2.new(1, -20, 1, -20)}, Theme.NormalSpeed)
            
            task.delay(duration, function()
                Util.Tween(NotifFrame, {Position = UDim2.new(1, 20, 1, -20)}, Theme.NormalSpeed)
                
                task.delay(Theme.NormalSpeed + 0.1, function()
                    NotifFrame:Destroy()
                end)
            end)
        end
    }
    
    local SettingsTab = API:CreateTab("Settings", false)
    
    local UISection = SettingsTab:AddSection("Interface")
    
    UISection:AddSlider({
        Name = "UI Scale",
        Min = 50,
        Max = 150,
        Default = 100,
        Suffix = "%",
        Callback = function(value)
            API:SetScale(value)
        end
    })
    
    UISection:AddToggle({
        Name = "Smooth Animations",
        Default = true,
        Callback = function(state)
            if state then
                Theme.QuickSpeed = 0.12
                Theme.NormalSpeed = 0.2
                Theme.SlowSpeed = 0.35
            else
                Theme.QuickSpeed = 0.06
                Theme.NormalSpeed = 0.1
                Theme.SlowSpeed = 0.15
            end
        end
    })
    
    local UtilSection = SettingsTab:AddSection("Utility")
    
    UtilSection:AddButton({
        Name = "Copy Discord Invite",
        ButtonText = "Copy",
        Callback = function()
            pcall(function()
                (setclipboard or toclipboard or function() end)(discordInvite)
            end)
            API:Notify("Copied", "Discord invite copied to clipboard!", 2)
        end
    })
    
    UtilSection:AddButton({
        Name = "Rejoin Server",
        ButtonText = "Rejoin",
        Callback = function()
            TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, LocalPlayer)
        end
    })
    
    local DangerSection = SettingsTab:AddSection("Danger Zone")
    
    DangerSection:AddButton({
        Name = "Destroy UI",
        ButtonText = "Destroy",
        Callback = function()
            API:Destroy()
        end
    })
    
    return API
end

-- Built-in Key System Integration
function Kovari:Load(config)
    config = config or {}
    
    if config.KeySystem then
        local keyConfig = config.KeySystem
        keyConfig.OnSuccess = function()
            self:Init(config)
        end
        keyConfig.OnFailed = keyConfig.OnFailed or function() end
        
        return self:CreateKeyUI(keyConfig)
    else
        return self:Init(config)
    end
end

_G.KovariInstance = Kovari

return Kovari

--[[
USAGE EXAMPLE WITH JUNKIE:

local Kovari = loadstring(game:HttpGet("YOUR_URL"))()

-- With Junkie Key System
local UI = Kovari:Load({
    ToggleKey = Enum.KeyCode.RightControl,
    Discord = "discord.gg/QcvddpVeTM",
    KeySystem = {
        Title = "My Script",
        Subtitle = "Premium Script",
        Service = "key system",
        Identifier = tostring(game.Players.LocalPlayer.UserId),
        Provider = "key system",
        ApiKey = "0015f93e-20bf-48fb-a444-33b056019ebe",
        Discord = "discord.gg/QcvddpVeTM"
    }
})

-- Wait for key validation
while not getgenv().SCRIPT_KEY and not getgenv().UI_CLOSED do
    task.wait(0.1)
end

if not getgenv().SCRIPT_KEY then
    return -- User closed UI without valid key
end

-- Your script continues here with validated key
local MainTab = UI:CreateTab("Main", true)
local Section = MainTab:AddSection("Features")

Section:AddToggle({
    Name = "Enable Feature",
    Default = false,
    Callback = function(state)
        print("Toggle:", state)
    end
})
]]
